apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: main-ingress
  annotations:
    # 1. Tell Kubernetes to use the Azure Gateway
    kubernetes.io/ingress.class: azure/application-gateway

    # 2. Rewrite Logic:
    # This strips the path prefix from the URL before sending it to the backend.
    # So "/api/users" becomes "/users" when it hits your Java app.
    appgw.ingress.kubernetes.io/backend-path-prefix: "/"
spec:
  rules:
    - http:
        paths:
          # RULE 1: API Traffic -> Backend
          # Note: Ensure 'name' matches your actual running service (kubectl get services)
          - path: /api/*
            pathType: ImplementationSpecific
            backend:
              service:
                name: testapp-service
                port:
                  number: 80

          # RULE 2: All other traffic -> Frontend
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: testapp-frontend-service
                port:
                  number: 80
